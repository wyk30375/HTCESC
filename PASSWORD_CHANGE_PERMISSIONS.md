# 密码修改功能权限说明

## 权限概述

系统提供了两个密码修改入口，根据用户角色有不同的访问权限。

---

## 功能入口和权限

### 1. 个人设置页面 (/profile)

**适用人群**：✅ 所有员工
- ✅ 管理员 (admin)
- ✅ 普通员工 (employee)
- ✅ 超级管理员 (super_admin)

**菜单位置**：侧边栏 → 系统设置 → 个人设置

**功能**：
- 查看个人信息（用户名、角色、邮箱、手机号）
- 修改登录密码
- 查看安全提示

**推荐使用**：✅ 推荐所有员工使用此页面修改密码

---

### 2. 车行信息页面 (/dealership-settings)

**适用人群**：❌ 仅管理员
- ✅ 管理员 (admin)
- ❌ 普通员工 (employee) - 无权限访问
- ✅ 超级管理员 (super_admin)

**菜单位置**：侧边栏 → 系统设置 → 车行信息

**功能**：
- 管理车行基本信息（名称、联系人、地址等）
- 修改登录密码（在"账号安全"部分）

**权限限制**：
- 普通员工无法看到此菜单项
- 普通员工无法访问此页面
- 只有管理员可以管理车行信息

---

## 权限设计原因

### 为什么普通员工不能访问车行信息页面？

1. **信息安全**
   - 车行基本信息属于敏感信息
   - 包含联系人、电话、地址等
   - 只有管理员有权查看和修改

2. **职责分离**
   - 管理员负责车行管理
   - 普通员工负责日常业务
   - 明确的权限边界

3. **防止误操作**
   - 避免普通员工误修改车行信息
   - 保证数据的准确性和一致性

---

## 使用建议

### 对普通员工
- ✅ 使用"个人设置"页面修改密码
- ✅ 在"个人设置"页面查看个人信息
- ❌ 不要尝试访问"车行信息"页面（无权限）

### 对管理员
- ✅ 推荐使用"个人设置"页面修改密码（更专注）
- ✅ 也可以在"车行信息"页面修改密码（同时管理车行信息）
- ✅ 在"车行信息"页面管理车行基本信息

---

## 权限实现

### 侧边栏导航控制
```typescript
// src/components/layouts/Layout.tsx
const navItems = [
  // 所有员工可见
  { path: '/profile', label: '个人设置', icon: UserCircle, roles: ['admin', 'employee'], group: 'settings' },
  
  // 仅管理员可见
  { path: '/dealership-settings', label: '车行信息', icon: Building2, roles: ['admin'], group: 'settings' },
];
```

### 路由配置
```typescript
// src/routes.tsx
{
  path: '/profile',
  component: EmployeeProfile,
  title: '个人设置',
  // 所有员工可访问
},
{
  path: '/dealership-settings',
  component: DealershipSettings,
  title: '车行信息',
  // 通过侧边栏控制，只有管理员可见
},
```

---

## 功能对比表

| 功能 | 个人设置 | 车行信息 |
|------|---------|---------|
| **适用人群** | 所有员工 | 仅管理员 |
| **查看个人信息** | ✅ | ❌ |
| **修改密码** | ✅ | ✅ |
| **管理车行信息** | ❌ | ✅ |
| **安全提示** | ✅ | ❌ |
| **普通员工可访问** | ✅ | ❌ |
| **管理员可访问** | ✅ | ✅ |

---

## 常见问题

### Q: 普通员工如何修改密码？
A: 点击侧边栏"个人设置"菜单，在"账号安全"部分修改密码。

### Q: 普通员工为什么看不到"车行信息"菜单？
A: 这是正常的。"车行信息"页面只有管理员可以访问，普通员工无权限查看车行基本信息。

### Q: 管理员应该在哪里修改密码？
A: 推荐使用"个人设置"页面。如果需要同时管理车行信息，也可以在"车行信息"页面修改。

### Q: 如果普通员工直接访问 /dealership-settings 会怎样？
A: 系统会通过侧边栏权限控制，普通员工无法看到此菜单项。如果直接输入 URL，建议在路由层面添加权限检查。

### Q: 为什么要提供两个密码修改入口？
A: 
- "个人设置"：专注于个人账号管理，所有员工可用
- "车行信息"：方便管理员在管理车行信息时顺便修改密码

---

## 安全建议

### 对系统管理员
1. **定期审查权限**：确保权限配置正确
2. **监控访问日志**：关注异常访问行为
3. **培训员工**：让员工了解权限边界
4. **最小权限原则**：只给予必要的权限

### 对普通员工
1. **使用正确入口**：通过"个人设置"修改密码
2. **不要尝试越权**：不要尝试访问无权限的页面
3. **保护账号安全**：定期修改密码，不与他人分享

### 对管理员
1. **谨慎操作**：修改车行信息时要仔细核对
2. **保护敏感信息**：不要泄露车行基本信息
3. **合理授权**：只给予必要的管理员权限

---

## 相关文件

- `src/pages/EmployeeProfile.tsx` - 个人设置页面（所有员工可访问）
- `src/pages/DealershipSettings.tsx` - 车行信息页面（仅管理员可访问）
- `src/components/layouts/Layout.tsx` - 侧边栏导航权限配置
- `src/routes.tsx` - 路由配置
- `supabase/functions/change-password/index.ts` - 密码修改 Edge Function

---

## 更新日志

### v2.1.1 (2026-01-10)
- ✅ 明确权限说明：车行信息页面仅管理员可访问
- ✅ 个人设置页面所有员工可访问
- ✅ 创建权限说明文档
- ✅ 优化功能定位和用户体验
