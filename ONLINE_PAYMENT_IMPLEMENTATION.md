# çº¿ä¸Šæ”¯ä»˜å®ç°æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

å½“å‰ç³»ç»Ÿå·²å®ç°æ‰«ç æ”¯ä»˜çš„åŸºç¡€æ¡†æ¶ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ”¯ä»˜è¿›è¡Œæµ‹è¯•ã€‚è¦å®ç°çœŸæ­£çš„çº¿ä¸Šæ”¯ä»˜ï¼Œéœ€è¦é›†æˆç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ï¼ˆå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ç­‰ï¼‰ã€‚

---

## ğŸ’³ æ”¯ä»˜å¹³å°é€‰æ‹©

### 1. å¾®ä¿¡æ”¯ä»˜ â­â­â­â­â­ å¼ºçƒˆæ¨è

**ä¼˜åŠ¿**ï¼š
- âœ… ç”¨æˆ·è¦†ç›–ç‡æœ€é«˜ï¼ˆ12äº¿+ç”¨æˆ·ï¼‰
- âœ… æ”¯ä»˜ä½“éªŒæœ€å¥½ï¼ˆå¾®ä¿¡å†…ä¸€é”®æ”¯ä»˜ï¼‰
- âœ… æ‰‹ç»­è´¹è¾ƒä½ï¼ˆ0.6%ï¼‰
- âœ… åˆ°è´¦å¿«ï¼ˆT+1ï¼‰
- âœ… æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼ˆæ‰«ç ã€H5ã€å°ç¨‹åºã€APPï¼‰

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦ä¼ä¸šèµ„è´¨ï¼ˆè¥ä¸šæ‰§ç…§ã€å¯¹å…¬è´¦æˆ·ï¼‰
- âš ï¸ å®¡æ ¸è¾ƒä¸¥æ ¼ï¼ˆ1-3ä¸ªå·¥ä½œæ—¥ï¼‰
- âš ï¸ éœ€è¦ICPå¤‡æ¡ˆ

**è´¹ç”¨**ï¼š
- å¼€é€šè´¹ç”¨ï¼šå…è´¹
- æ‰‹ç»­è´¹ï¼š0.6%/ç¬”
- æç°è´¹ç”¨ï¼šå…è´¹ï¼ˆåˆ°å¯¹å…¬è´¦æˆ·ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- é¢å‘Cç«¯ç”¨æˆ·
- éœ€è¦å¾®ä¿¡ç”Ÿæ€é›†æˆ
- è¿½æ±‚æœ€ä½³ç”¨æˆ·ä½“éªŒ

---

### 2. æ”¯ä»˜å® â­â­â­â­â­ å¼ºçƒˆæ¨è

**ä¼˜åŠ¿**ï¼š
- âœ… ç”¨æˆ·è¦†ç›–ç‡é«˜ï¼ˆ10äº¿+ç”¨æˆ·ï¼‰
- âœ… æ”¯ä»˜ä½“éªŒå¥½
- âœ… æ‰‹ç»­è´¹è¾ƒä½ï¼ˆ0.6%ï¼‰
- âœ… åˆ°è´¦å¿«ï¼ˆT+1ï¼‰
- âœ… æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼ˆæ‰«ç ã€H5ã€APPï¼‰
- âœ… æŠ€æœ¯æ–‡æ¡£å®Œå–„

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦ä¼ä¸šèµ„è´¨
- âš ï¸ å®¡æ ¸è¾ƒä¸¥æ ¼

**è´¹ç”¨**ï¼š
- å¼€é€šè´¹ç”¨ï¼šå…è´¹
- æ‰‹ç»­è´¹ï¼š0.6%/ç¬”
- æç°è´¹ç”¨ï¼šå…è´¹ï¼ˆåˆ°å¯¹å…¬è´¦æˆ·ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- é¢å‘Cç«¯ç”¨æˆ·
- éœ€è¦æ”¯ä»˜å®ç”Ÿæ€é›†æˆ
- è¿½æ±‚ç¨³å®šå¯é 

---

### 3. èšåˆæ”¯ä»˜å¹³å° â­â­â­â­ æ¨è

**ä»£è¡¨å¹³å°**ï¼š
- Ping++ï¼ˆå›½å†…é¢†å…ˆï¼‰
- BeeCloudï¼ˆæ˜“ç”¨æ€§å¥½ï¼‰
- PayJSï¼ˆä¸ªäººå¯ç”¨ï¼‰
- è™çš®æ¤’ï¼ˆä¸ªäººå¯ç”¨ï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… ä¸€æ¬¡é›†æˆï¼Œæ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼
- âœ… æŠ€æœ¯é—¨æ§›ä½
- âœ… å¼€å‘æ•ˆç‡é«˜
- âœ… éƒ¨åˆ†æ”¯æŒä¸ªäººå¼€å‘è€…

**åŠ£åŠ¿**ï¼š
- âš ï¸ æ‰‹ç»­è´¹è¾ƒé«˜ï¼ˆ1%-3%ï¼‰
- âš ï¸ ä¾èµ–ç¬¬ä¸‰æ–¹å¹³å°
- âš ï¸ éƒ¨åˆ†å¹³å°ç¨³å®šæ€§ä¸€èˆ¬

**è´¹ç”¨**ï¼š
- å¼€é€šè´¹ç”¨ï¼šå…è´¹-Â¥1,000
- æ‰‹ç»­è´¹ï¼š1%-3%/ç¬”
- æœˆè´¹ï¼šÂ¥0-Â¥500

**é€‚ç”¨åœºæ™¯**ï¼š
- å¿«é€Ÿä¸Šçº¿
- ä¸ªäººå¼€å‘è€…
- å¤šæ”¯ä»˜æ–¹å¼éœ€æ±‚

---

### 4. é“¶è”æ”¯ä»˜ â­â­â­

**ä¼˜åŠ¿**ï¼š
- âœ… å®˜æ–¹èƒŒæ™¯ï¼Œå®‰å…¨å¯é 
- âœ… æ”¯æŒæ‰€æœ‰é“¶è¡Œå¡
- âœ… é€‚åˆå¤§é¢æ”¯ä»˜

**åŠ£åŠ¿**ï¼š
- âš ï¸ ç”¨æˆ·ä½“éªŒä¸€èˆ¬
- âš ï¸ æ‰‹ç»­è´¹è¾ƒé«˜ï¼ˆ1%-2%ï¼‰
- âš ï¸ æŠ€æœ¯æ–‡æ¡£å¤æ‚

**è´¹ç”¨**ï¼š
- å¼€é€šè´¹ç”¨ï¼šå…è´¹
- æ‰‹ç»­è´¹ï¼š1%-2%/ç¬”

**é€‚ç”¨åœºæ™¯**ï¼š
- Bç«¯ä¼ä¸šæ”¯ä»˜
- å¤§é¢äº¤æ˜“
- éœ€è¦é“¶è¡Œå¡æ”¯ä»˜

---

## ğŸ† æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå¾®ä¿¡æ”¯ä»˜ + æ”¯ä»˜å®ï¼ˆæœ€ä½³ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæ­£è§„ä¼ä¸šè¿è¥

**ä¼˜åŠ¿**ï¼š
- è¦†ç›–95%ä»¥ä¸Šç”¨æˆ·
- æ‰‹ç»­è´¹æœ€ä½
- ç”¨æˆ·ä½“éªŒæœ€å¥½
- å“ç‰Œå½¢è±¡å¥½

**å®æ–½æˆæœ¬**ï¼š
- å¼€å‘æ—¶é—´ï¼š3-5å¤©
- å¼€å‘æˆæœ¬ï¼šÂ¥5,000-10,000
- æ‰‹ç»­è´¹ï¼š0.6%

---

### æ–¹æ¡ˆ2ï¼šèšåˆæ”¯ä»˜å¹³å°ï¼ˆå¿«é€Ÿä¸Šçº¿ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¿«é€ŸéªŒè¯ã€ä¸ªäººå¼€å‘è€…

**ä¼˜åŠ¿**ï¼š
- å¿«é€Ÿé›†æˆï¼ˆ1-2å¤©ï¼‰
- æŠ€æœ¯é—¨æ§›ä½
- æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼

**å®æ–½æˆæœ¬**ï¼š
- å¼€å‘æ—¶é—´ï¼š1-2å¤©
- å¼€å‘æˆæœ¬ï¼šÂ¥2,000-5,000
- æ‰‹ç»­è´¹ï¼š1%-3%

---

## ğŸ”§ å¾®ä¿¡æ”¯ä»˜é›†æˆæ–¹æ¡ˆï¼ˆè¯¦ç»†ï¼‰

### ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œå¾®ä¿¡æ”¯ä»˜å•†æˆ·

#### 1.1 å‡†å¤‡èµ„æ–™

**ä¼ä¸šèµ„è´¨**ï¼š
- è¥ä¸šæ‰§ç…§ï¼ˆæ‰«æä»¶ï¼‰
- æ³•äººèº«ä»½è¯ï¼ˆæ­£åé¢ï¼‰
- å¯¹å…¬è´¦æˆ·ä¿¡æ¯
- ç»è¥åœºæ‰€ç…§ç‰‡
- ICPå¤‡æ¡ˆå·

**ä¸ªäººèµ„è´¨**ï¼ˆå°å¾®å•†æˆ·ï¼‰ï¼š
- èº«ä»½è¯ï¼ˆæ­£åé¢ï¼‰
- é“¶è¡Œå¡ä¿¡æ¯
- ç»è¥åœºæ‰€ç…§ç‰‡
- æ‰‹æŒèº«ä»½è¯ç…§ç‰‡

#### 1.2 æ³¨å†Œæµç¨‹

1. è®¿é—® [å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°](https://pay.weixin.qq.com/)
2. ç‚¹å‡»"ç«‹å³æ³¨å†Œ"
3. é€‰æ‹©"ä¼ä¸š"æˆ–"å°å¾®å•†æˆ·"
4. å¡«å†™åŸºæœ¬ä¿¡æ¯
5. ä¸Šä¼ èµ„è´¨ææ–™
6. ç­‰å¾…å®¡æ ¸ï¼ˆ1-3ä¸ªå·¥ä½œæ—¥ï¼‰
7. ç­¾ç½²åè®®
8. è·å–å•†æˆ·å·å’ŒAPIå¯†é’¥

#### 1.3 è·å–å¯†é’¥

**å•†æˆ·å·ï¼ˆmch_idï¼‰**ï¼š
- å®¡æ ¸é€šè¿‡åè‡ªåŠ¨åˆ†é…
- æ ¼å¼ï¼š10ä½æ•°å­—

**APIå¯†é’¥ï¼ˆapi_keyï¼‰**ï¼š
- ç™»å½•å•†æˆ·å¹³å°
- è´¦æˆ·ä¸­å¿ƒ â†’ APIå®‰å…¨ â†’ è®¾ç½®APIå¯†é’¥
- 32ä½å­—ç¬¦ä¸²ï¼Œå¦¥å–„ä¿ç®¡

**APIè¯ä¹¦**ï¼š
- è´¦æˆ·ä¸­å¿ƒ â†’ APIå®‰å…¨ â†’ ä¸‹è½½è¯ä¹¦
- ç”¨äºé€€æ¬¾ç­‰æ•æ„Ÿæ“ä½œ

---

### ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

```bash
# å®‰è£…å¾®ä¿¡æ”¯ä»˜SDK
npm install wechatpay-node-v3

# æˆ–ä½¿ç”¨ä¼ ç»ŸSDK
npm install wechatpay-axios-plugin
```

---

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºEdge Function

**æ–‡ä»¶**ï¼š`supabase/functions/wechat-pay/index.ts`

```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
import Payment from 'https://esm.sh/wechatpay-node-v3@1.0.0';

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

// åˆå§‹åŒ–å¾®ä¿¡æ”¯ä»˜
const payment = new Payment({
  appid: Deno.env.get('WECHAT_APPID')!,
  mchid: Deno.env.get('WECHAT_MCHID')!,
  private_key: Deno.env.get('WECHAT_PRIVATE_KEY')!,
  serial_no: Deno.env.get('WECHAT_SERIAL_NO')!,
  apiv3_private_key: Deno.env.get('WECHAT_APIV3_KEY')!,
});

serve(async (req) => {
  // å¤„ç†CORSé¢„æ£€è¯·æ±‚
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders });
  }

  try {
    const { action, data } = await req.json();

    // åˆ›å»ºè®¢å•
    if (action === 'create') {
      const { order_no, amount, description } = data;

      // è°ƒç”¨å¾®ä¿¡æ”¯ä»˜Nativeä¸‹å•API
      const result = await payment.native({
        description,
        out_trade_no: order_no,
        amount: {
          total: Math.round(amount * 100), // è½¬æ¢ä¸ºåˆ†
        },
        notify_url: `${Deno.env.get('SUPABASE_URL')}/functions/v1/wechat-pay-notify`,
      });

      return new Response(
        JSON.stringify({
          success: true,
          qr_code: result.code_url, // äºŒç»´ç é“¾æ¥
        }),
        {
          headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        }
      );
    }

    // æŸ¥è¯¢è®¢å•
    if (action === 'query') {
      const { order_no } = data;

      const result = await payment.query({
        out_trade_no: order_no,
      });

      return new Response(
        JSON.stringify({
          success: true,
          status: result.trade_state, // SUCCESS, REFUND, NOTPAY, CLOSED, REVOKED, USERPAYING, PAYERROR
          transaction_id: result.transaction_id,
        }),
        {
          headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        }
      );
    }

    // å…³é—­è®¢å•
    if (action === 'close') {
      const { order_no } = data;

      await payment.close({
        out_trade_no: order_no,
      });

      return new Response(
        JSON.stringify({ success: true }),
        {
          headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        }
      );
    }

    return new Response(
      JSON.stringify({ error: 'Invalid action' }),
      {
        status: 400,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
      }
    );
  } catch (error) {
    console.error('å¾®ä¿¡æ”¯ä»˜é”™è¯¯:', error);
    return new Response(
      JSON.stringify({ error: error.message }),
      {
        status: 500,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
      }
    );
  }
});
```

---

### ç¬¬å››æ­¥ï¼šåˆ›å»ºæ”¯ä»˜å›è°ƒå¤„ç†

**æ–‡ä»¶**ï¼š`supabase/functions/wechat-pay-notify/index.ts`

```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
import Payment from 'https://esm.sh/wechatpay-node-v3@1.0.0';

const payment = new Payment({
  appid: Deno.env.get('WECHAT_APPID')!,
  mchid: Deno.env.get('WECHAT_MCHID')!,
  private_key: Deno.env.get('WECHAT_PRIVATE_KEY')!,
  serial_no: Deno.env.get('WECHAT_SERIAL_NO')!,
  apiv3_private_key: Deno.env.get('WECHAT_APIV3_KEY')!,
});

serve(async (req) => {
  try {
    // è·å–è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“
    const signature = req.headers.get('Wechatpay-Signature');
    const timestamp = req.headers.get('Wechatpay-Timestamp');
    const nonce = req.headers.get('Wechatpay-Nonce');
    const serial = req.headers.get('Wechatpay-Serial');
    const body = await req.text();

    // éªŒè¯ç­¾å
    const verified = payment.verifySignature({
      signature,
      timestamp,
      nonce,
      serial,
      body,
    });

    if (!verified) {
      console.error('ç­¾åéªŒè¯å¤±è´¥');
      return new Response(
        JSON.stringify({ code: 'FAIL', message: 'ç­¾åéªŒè¯å¤±è´¥' }),
        { status: 401, headers: { 'Content-Type': 'application/json' } }
      );
    }

    // è§£å¯†é€šçŸ¥æ•°æ®
    const data = JSON.parse(body);
    const decrypted = payment.decipher(data.resource);
    const notification = JSON.parse(decrypted);

    console.log('æ”¯ä»˜é€šçŸ¥:', notification);

    // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
    const supabase = createClient(
      Deno.env.get('SUPABASE_URL')!,
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
    );

    // æ›´æ–°è®¢å•çŠ¶æ€
    const { out_trade_no, transaction_id, trade_state, amount } = notification;

    if (trade_state === 'SUCCESS') {
      // 1. æ›´æ–°payment_ordersè¡¨
      await supabase
        .from('payment_orders')
        .update({
          status: 'paid',
          transaction_id,
          paid_at: new Date().toISOString(),
        })
        .eq('order_no', out_trade_no);

      // 2. æŸ¥è¯¢è®¢å•ä¿¡æ¯
      const { data: order } = await supabase
        .from('payment_orders')
        .select('dealership_id, tier_id, amount')
        .eq('order_no', out_trade_no)
        .single();

      if (order) {
        // 3. åˆ›å»ºæ”¯ä»˜è®°å½•
        await supabase.from('membership_payments').insert({
          dealership_id: order.dealership_id,
          tier_id: order.tier_id,
          amount: order.amount,
          payment_method: 'wechat',
          transaction_id,
          status: 'completed',
        });

        // 4. æ›´æ–°æˆ–åˆ›å»ºä¼šå‘˜è®°å½•
        const { data: existingMembership } = await supabase
          .from('dealership_memberships')
          .select('id, end_date')
          .eq('dealership_id', order.dealership_id)
          .eq('status', 'active')
          .single();

        const startDate = existingMembership?.end_date
          ? new Date(existingMembership.end_date)
          : new Date();
        const endDate = new Date(startDate);
        endDate.setFullYear(endDate.getFullYear() + 1);

        if (existingMembership) {
          // ç»­è´¹
          await supabase
            .from('dealership_memberships')
            .update({
              tier_id: order.tier_id,
              end_date: endDate.toISOString(),
              is_trial: false,
            })
            .eq('id', existingMembership.id);
        } else {
          // æ–°å¼€é€š
          await supabase.from('dealership_memberships').insert({
            dealership_id: order.dealership_id,
            tier_id: order.tier_id,
            start_date: startDate.toISOString(),
            end_date: endDate.toISOString(),
            is_trial: false,
            status: 'active',
          });
        }
      }
    }

    // è¿”å›æˆåŠŸå“åº”
    return new Response(
      JSON.stringify({ code: 'SUCCESS', message: 'æˆåŠŸ' }),
      {
        status: 200,
        headers: { 'Content-Type': 'application/json' },
      }
    );
  } catch (error) {
    console.error('å¤„ç†æ”¯ä»˜é€šçŸ¥å¤±è´¥:', error);
    return new Response(
      JSON.stringify({ code: 'FAIL', message: error.message }),
      {
        status: 500,
        headers: { 'Content-Type': 'application/json' },
      }
    );
  }
});
```

---

### ç¬¬äº”æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

**Supabase Dashboard â†’ Settings â†’ Edge Functions â†’ Secrets**

```bash
# å¾®ä¿¡æ”¯ä»˜é…ç½®
WECHAT_APPID=wx1234567890abcdef        # å¾®ä¿¡å…¬ä¼—å·/å°ç¨‹åºAppID
WECHAT_MCHID=1234567890                # å•†æˆ·å·
WECHAT_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----...  # å•†æˆ·ç§é’¥
WECHAT_SERIAL_NO=1234567890ABCDEF      # è¯ä¹¦åºåˆ—å·
WECHAT_APIV3_KEY=32ä½å­—ç¬¦ä¸²             # APIv3å¯†é’¥
```

---

### ç¬¬å…­æ­¥ï¼šå‰ç«¯è°ƒç”¨

**æ–‡ä»¶**ï¼š`src/db/paymentApi.ts`

```typescript
import { supabase } from './supabase';

// åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•
export async function createWechatPayOrder(params: {
  dealershipId: string;
  tierId: string;
  amount: number;
  description: string;
}) {
  // 1. åˆ›å»ºè®¢å•è®°å½•
  const orderNo = `WX${Date.now()}${Math.random().toString(36).substr(2, 9)}`;
  
  const { data: order, error: orderError } = await supabase
    .from('payment_orders')
    .insert({
      order_no: orderNo,
      dealership_id: params.dealershipId,
      tier_id: params.tierId,
      amount: params.amount,
      payment_method: 'wechat',
      status: 'pending',
    })
    .select()
    .single();

  if (orderError) throw orderError;

  // 2. è°ƒç”¨Edge Functionåˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•
  const { data, error } = await supabase.functions.invoke('wechat-pay', {
    body: {
      action: 'create',
      data: {
        order_no: orderNo,
        amount: params.amount,
        description: params.description,
      },
    },
  });

  if (error) throw error;

  return {
    order_no: orderNo,
    qr_code: data.qr_code, // äºŒç»´ç é“¾æ¥
  };
}

// æŸ¥è¯¢å¾®ä¿¡æ”¯ä»˜è®¢å•çŠ¶æ€
export async function queryWechatPayOrder(orderNo: string) {
  const { data, error } = await supabase.functions.invoke('wechat-pay', {
    body: {
      action: 'query',
      data: { order_no: orderNo },
    },
  });

  if (error) throw error;

  // åŒæ­¥æ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€
  if (data.status === 'SUCCESS') {
    await supabase
      .from('payment_orders')
      .update({ status: 'paid' })
      .eq('order_no', orderNo);
  }

  return {
    status: data.status === 'SUCCESS' ? 'paid' : 'pending',
    transaction_id: data.transaction_id,
  };
}
```

---

### ç¬¬ä¸ƒæ­¥ï¼šå‰ç«¯æ˜¾ç¤ºäºŒç»´ç 

**æ–‡ä»¶**ï¼š`src/pages/MembershipCenter.tsx`

```typescript
import QRCode from 'qrcode';

// åœ¨handleOpenPaymentå‡½æ•°ä¸­
const handleOpenPayment = async (tier: MembershipTier) => {
  try {
    setPaymentLoading(true);
    setSelectedTier(tier);

    // åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•
    const order = await createWechatPayOrder({
      dealershipId: profile.dealership_id,
      tierId: tier.id,
      amount: tier.annual_fee,
      description: `${tier.tier_name}ä¼šå‘˜å¹´è´¹`,
    });

    // ç”ŸæˆäºŒç»´ç å›¾ç‰‡
    const qrCodeDataUrl = await QRCode.toDataURL(order.qr_code, {
      width: 300,
      margin: 2,
    });

    setPaymentOrder({
      ...order,
      qr_code_image: qrCodeDataUrl,
    });
    setPaymentDialogOpen(true);

    // å¼€å§‹è½®è¯¢è®¢å•çŠ¶æ€
    startPaymentCheck(order.order_no);
  } catch (error) {
    console.error('åˆ›å»ºæ”¯ä»˜è®¢å•å¤±è´¥:', error);
    toast.error('åˆ›å»ºæ”¯ä»˜è®¢å•å¤±è´¥');
  } finally {
    setPaymentLoading(false);
  }
};

// è½®è¯¢æ£€æŸ¥æ”¯ä»˜çŠ¶æ€
const startPaymentCheck = (orderNo: string) => {
  setCheckingPayment(true);

  const checkInterval = setInterval(async () => {
    try {
      const order = await queryWechatPayOrder(orderNo);

      if (order.status === 'paid') {
        clearInterval(checkInterval);
        setCheckingPayment(false);
        toast.success('æ”¯ä»˜æˆåŠŸï¼ä¼šå‘˜å·²å¼€é€š');
        setPaymentDialogOpen(false);
        loadData(); // é‡æ–°åŠ è½½æ•°æ®
      }
    } catch (error) {
      console.error('æ£€æŸ¥æ”¯ä»˜çŠ¶æ€å¤±è´¥:', error);
    }
  }, 3000); // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡

  // 5åˆ†é’Ÿååœæ­¢æ£€æŸ¥
  setTimeout(() => {
    clearInterval(checkInterval);
    setCheckingPayment(false);
  }, 5 * 60 * 1000);
};
```

---

## ğŸ”§ æ”¯ä»˜å®é›†æˆæ–¹æ¡ˆï¼ˆè¯¦ç»†ï¼‰

### ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œæ”¯ä»˜å®å•†æˆ·

#### 1.1 å‡†å¤‡èµ„æ–™

**ä¼ä¸šèµ„è´¨**ï¼š
- è¥ä¸šæ‰§ç…§
- æ³•äººèº«ä»½è¯
- å¯¹å…¬è´¦æˆ·ä¿¡æ¯
- ç½‘ç«™ä¿¡æ¯

#### 1.2 æ³¨å†Œæµç¨‹

1. è®¿é—® [æ”¯ä»˜å®å¼€æ”¾å¹³å°](https://open.alipay.com/)
2. æ³¨å†Œè´¦å·å¹¶ç™»å½•
3. åˆ›å»ºåº”ç”¨ï¼ˆç½‘é¡µ/ç§»åŠ¨åº”ç”¨ï¼‰
4. å¡«å†™åº”ç”¨ä¿¡æ¯
5. ä¸Šä¼ èµ„è´¨ææ–™
6. ç­‰å¾…å®¡æ ¸ï¼ˆ1-3ä¸ªå·¥ä½œæ—¥ï¼‰
7. ç­¾çº¦"ç”µè„‘ç½‘ç«™æ”¯ä»˜"æˆ–"æ‰‹æœºç½‘ç«™æ”¯ä»˜"
8. è·å–APPIDå’Œå¯†é’¥

#### 1.3 é…ç½®å¯†é’¥

**ç”ŸæˆRSAå¯†é’¥**ï¼š
```bash
# ä½¿ç”¨æ”¯ä»˜å®æä¾›çš„å¯†é’¥ç”Ÿæˆå·¥å…·
# ä¸‹è½½åœ°å€ï¼šhttps://opendocs.alipay.com/common/02kipl

# æˆ–ä½¿ç”¨OpenSSLç”Ÿæˆ
openssl genrsa -out app_private_key.pem 2048
openssl rsa -in app_private_key.pem -pubout -out app_public_key.pem
```

**é…ç½®å¯†é’¥**ï¼š
1. ç™»å½•å¼€æ”¾å¹³å°
2. è¿›å…¥åº”ç”¨è¯¦æƒ…
3. å¼€å‘ä¿¡æ¯ â†’ æ¥å£åŠ ç­¾æ–¹å¼ â†’ è®¾ç½®
4. ä¸Šä¼ åº”ç”¨å…¬é’¥
5. è·å–æ”¯ä»˜å®å…¬é’¥

---

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºEdge Function

**æ–‡ä»¶**ï¼š`supabase/functions/alipay/index.ts`

```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
import AlipaySdk from 'https://esm.sh/alipay-sdk@3.4.0';

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

// åˆå§‹åŒ–æ”¯ä»˜å®SDK
const alipaySdk = new AlipaySdk({
  appId: Deno.env.get('ALIPAY_APPID')!,
  privateKey: Deno.env.get('ALIPAY_PRIVATE_KEY')!,
  alipayPublicKey: Deno.env.get('ALIPAY_PUBLIC_KEY')!,
  gateway: 'https://openapi.alipay.com/gateway.do',
  timeout: 5000,
});

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders });
  }

  try {
    const { action, data } = await req.json();

    // åˆ›å»ºè®¢å•
    if (action === 'create') {
      const { order_no, amount, description } = data;

      // è°ƒç”¨æ”¯ä»˜å®é¢„ä¸‹å•APIï¼ˆæ‰«ç æ”¯ä»˜ï¼‰
      const result = await alipaySdk.exec('alipay.trade.precreate', {
        bizContent: {
          out_trade_no: order_no,
          total_amount: amount.toFixed(2),
          subject: description,
          timeout_express: '5m',
        },
        notifyUrl: `${Deno.env.get('SUPABASE_URL')}/functions/v1/alipay-notify`,
      });

      return new Response(
        JSON.stringify({
          success: true,
          qr_code: result.qrCode, // äºŒç»´ç å†…å®¹
        }),
        {
          headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        }
      );
    }

    // æŸ¥è¯¢è®¢å•
    if (action === 'query') {
      const { order_no } = data;

      const result = await alipaySdk.exec('alipay.trade.query', {
        bizContent: {
          out_trade_no: order_no,
        },
      });

      return new Response(
        JSON.stringify({
          success: true,
          status: result.tradeStatus, // WAIT_BUYER_PAY, TRADE_SUCCESS, TRADE_CLOSED
          trade_no: result.tradeNo,
        }),
        {
          headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        }
      );
    }

    // å…³é—­è®¢å•
    if (action === 'close') {
      const { order_no } = data;

      await alipaySdk.exec('alipay.trade.close', {
        bizContent: {
          out_trade_no: order_no,
        },
      });

      return new Response(
        JSON.stringify({ success: true }),
        {
          headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        }
      );
    }

    return new Response(
      JSON.stringify({ error: 'Invalid action' }),
      {
        status: 400,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
      }
    );
  } catch (error) {
    console.error('æ”¯ä»˜å®é”™è¯¯:', error);
    return new Response(
      JSON.stringify({ error: error.message }),
      {
        status: 500,
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
      }
    );
  }
});
```

---

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºæ”¯ä»˜å›è°ƒå¤„ç†

**æ–‡ä»¶**ï¼š`supabase/functions/alipay-notify/index.ts`

```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
import AlipaySdk from 'https://esm.sh/alipay-sdk@3.4.0';

const alipaySdk = new AlipaySdk({
  appId: Deno.env.get('ALIPAY_APPID')!,
  privateKey: Deno.env.get('ALIPAY_PRIVATE_KEY')!,
  alipayPublicKey: Deno.env.get('ALIPAY_PUBLIC_KEY')!,
});

serve(async (req) => {
  try {
    // è·å–POSTå‚æ•°
    const formData = await req.formData();
    const params: any = {};
    for (const [key, value] of formData.entries()) {
      params[key] = value;
    }

    console.log('æ”¯ä»˜å®é€šçŸ¥:', params);

    // éªŒè¯ç­¾å
    const verified = alipaySdk.checkNotifySign(params);
    if (!verified) {
      console.error('ç­¾åéªŒè¯å¤±è´¥');
      return new Response('fail', { status: 401 });
    }

    // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
    const supabase = createClient(
      Deno.env.get('SUPABASE_URL')!,
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
    );

    const {
      out_trade_no,
      trade_no,
      trade_status,
      total_amount,
    } = params;

    if (trade_status === 'TRADE_SUCCESS' || trade_status === 'TRADE_FINISHED') {
      // 1. æ›´æ–°payment_ordersè¡¨
      await supabase
        .from('payment_orders')
        .update({
          status: 'paid',
          transaction_id: trade_no,
          paid_at: new Date().toISOString(),
        })
        .eq('order_no', out_trade_no);

      // 2. æŸ¥è¯¢è®¢å•ä¿¡æ¯
      const { data: order } = await supabase
        .from('payment_orders')
        .select('dealership_id, tier_id, amount')
        .eq('order_no', out_trade_no)
        .single();

      if (order) {
        // 3. åˆ›å»ºæ”¯ä»˜è®°å½•
        await supabase.from('membership_payments').insert({
          dealership_id: order.dealership_id,
          tier_id: order.tier_id,
          amount: parseFloat(total_amount),
          payment_method: 'alipay',
          transaction_id: trade_no,
          status: 'completed',
        });

        // 4. æ›´æ–°æˆ–åˆ›å»ºä¼šå‘˜è®°å½•ï¼ˆåŒå¾®ä¿¡æ”¯ä»˜ï¼‰
        // ... çœç•¥ï¼Œé€»è¾‘ç›¸åŒ
      }
    }

    // è¿”å›æˆåŠŸå“åº”
    return new Response('success', { status: 200 });
  } catch (error) {
    console.error('å¤„ç†æ”¯ä»˜é€šçŸ¥å¤±è´¥:', error);
    return new Response('fail', { status: 500 });
  }
});
```

---

## ğŸ”’ å®‰å…¨æ€§ä¿éšœ

### 1. HTTPSå¼ºåˆ¶

**å¿…é¡»ä½¿ç”¨HTTPS**ï¼š
- æ‰€æœ‰æ”¯ä»˜ç›¸å…³è¯·æ±‚å¿…é¡»ä½¿ç”¨HTTPS
- Supabaseé»˜è®¤æä¾›HTTPS
- è‡ªå®šä¹‰åŸŸåéœ€é…ç½®SSLè¯ä¹¦

### 2. ç­¾åéªŒè¯

**å¾®ä¿¡æ”¯ä»˜**ï¼š
```typescript
// éªŒè¯å›è°ƒç­¾å
const verified = payment.verifySignature({
  signature,
  timestamp,
  nonce,
  serial,
  body,
});

if (!verified) {
  throw new Error('ç­¾åéªŒè¯å¤±è´¥');
}
```

**æ”¯ä»˜å®**ï¼š
```typescript
// éªŒè¯å›è°ƒç­¾å
const verified = alipaySdk.checkNotifySign(params);

if (!verified) {
  throw new Error('ç­¾åéªŒè¯å¤±è´¥');
}
```

### 3. å¯†é’¥ç®¡ç†

**å­˜å‚¨ä½ç½®**ï¼š
- âœ… Supabase Edge Functions Secrets
- âœ… ç¯å¢ƒå˜é‡
- âŒ ä»£ç ä¸­ç¡¬ç¼–ç 
- âŒ å‰ç«¯ä»£ç 

**è®¿é—®æ§åˆ¶**ï¼š
- åªæœ‰Edge Functionså¯ä»¥è®¿é—®
- ä½¿ç”¨SUPABASE_SERVICE_ROLE_KEY
- ä¸æš´éœ²ç»™å‰ç«¯

### 4. è®¢å•é˜²é‡

**å¹‚ç­‰æ€§ä¿è¯**ï¼š
```typescript
// æ£€æŸ¥è®¢å•æ˜¯å¦å·²å¤„ç†
const { data: existingOrder } = await supabase
  .from('payment_orders')
  .select('status')
  .eq('order_no', out_trade_no)
  .single();

if (existingOrder?.status === 'paid') {
  console.log('è®¢å•å·²å¤„ç†ï¼Œè·³è¿‡');
  return new Response('success', { status: 200 });
}
```

### 5. é‡‘é¢æ ¡éªŒ

**éªŒè¯æ”¯ä»˜é‡‘é¢**ï¼š
```typescript
// æŸ¥è¯¢è®¢å•é‡‘é¢
const { data: order } = await supabase
  .from('payment_orders')
  .select('amount')
  .eq('order_no', out_trade_no)
  .single();

// éªŒè¯é‡‘é¢æ˜¯å¦ä¸€è‡´
if (Math.abs(order.amount - parseFloat(total_amount)) > 0.01) {
  console.error('é‡‘é¢ä¸åŒ¹é…');
  throw new Error('é‡‘é¢ä¸åŒ¹é…');
}
```

### 6. æ—¥å¿—è®°å½•

**è®°å½•æ‰€æœ‰æ”¯ä»˜æ“ä½œ**ï¼š
```typescript
// è®°å½•æ”¯ä»˜æ—¥å¿—
await supabase.from('payment_logs').insert({
  order_no: out_trade_no,
  action: 'notify',
  request_data: JSON.stringify(params),
  response_data: JSON.stringify(result),
  created_at: new Date().toISOString(),
});
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. æ²™ç®±ç¯å¢ƒæµ‹è¯•

**å¾®ä¿¡æ”¯ä»˜æ²™ç®±**ï¼š
- è®¿é—® [å¾®ä¿¡æ”¯ä»˜æ²™ç®±](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_1)
- è·å–æ²™ç®±å¯†é’¥
- ä¿®æ”¹gatewayä¸ºæ²™ç®±åœ°å€
- ä½¿ç”¨æ²™ç®±è´¦å·æµ‹è¯•

**æ”¯ä»˜å®æ²™ç®±**ï¼š
- è®¿é—® [æ”¯ä»˜å®æ²™ç®±](https://openhome.alipay.com/develop/sandbox/app)
- è·å–æ²™ç®±APPIDå’Œå¯†é’¥
- ä¸‹è½½æ²™ç®±é’±åŒ…APP
- ä½¿ç”¨æ²™ç®±è´¦å·æµ‹è¯•

### 2. æœ¬åœ°æµ‹è¯•

**ä½¿ç”¨ngrokæš´éœ²æœ¬åœ°æœåŠ¡**ï¼š
```bash
# å®‰è£…ngrok
npm install -g ngrok

# å¯åŠ¨ngrok
ngrok http 54321

# å°†ngrok URLé…ç½®ä¸ºå›è°ƒåœ°å€
https://xxxx.ngrok.io/functions/v1/wechat-pay-notify
```

### 3. æ¨¡æ‹Ÿæ”¯ä»˜

**ä¿ç•™æ¨¡æ‹Ÿæ”¯ä»˜åŠŸèƒ½**ï¼š
```typescript
// æ·»åŠ ç¯å¢ƒå˜é‡æ§åˆ¶
const USE_MOCK_PAYMENT = Deno.env.get('USE_MOCK_PAYMENT') === 'true';

if (USE_MOCK_PAYMENT) {
  // ä½¿ç”¨æ¨¡æ‹Ÿæ”¯ä»˜
  return mockPayment(data);
} else {
  // ä½¿ç”¨çœŸå®æ”¯ä»˜
  return realPayment(data);
}
```

---

## ğŸ“Š æˆæœ¬åˆ†æ

### å¾®ä¿¡æ”¯ä»˜ + æ”¯ä»˜å®

| é¡¹ç›® | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| å¼€å‘æˆæœ¬ | Â¥5,000-10,000 | 3-5å¤©å¼€å‘æ—¶é—´ |
| å•†æˆ·å…¥é©» | Â¥0 | å…è´¹ |
| æ‰‹ç»­è´¹ | 0.6%/ç¬” | æŒ‰äº¤æ˜“é¢æ”¶å– |
| æç°è´¹ç”¨ | Â¥0 | åˆ°å¯¹å…¬è´¦æˆ·å…è´¹ |
| å¹´åº¦è´¹ç”¨ | Â¥0 | æ— å¹´è´¹ |

**ç¤ºä¾‹è®¡ç®—**ï¼š
- æœˆäº¤æ˜“é¢ï¼šÂ¥10,000
- æœˆæ‰‹ç»­è´¹ï¼šÂ¥10,000 Ã— 0.6% = Â¥60
- å¹´æ‰‹ç»­è´¹ï¼šÂ¥60 Ã— 12 = Â¥720

---

### èšåˆæ”¯ä»˜å¹³å°

| é¡¹ç›® | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| å¼€å‘æˆæœ¬ | Â¥2,000-5,000 | 1-2å¤©å¼€å‘æ—¶é—´ |
| å¹³å°å…¥é©» | Â¥0-1,000 | éƒ¨åˆ†å¹³å°æ”¶è´¹ |
| æ‰‹ç»­è´¹ | 1%-3%/ç¬” | æŒ‰äº¤æ˜“é¢æ”¶å– |
| æç°è´¹ç”¨ | Â¥0-2/ç¬” | éƒ¨åˆ†å¹³å°æ”¶è´¹ |
| å¹´åº¦è´¹ç”¨ | Â¥0-6,000 | éƒ¨åˆ†å¹³å°æ”¶æœˆè´¹ |

**ç¤ºä¾‹è®¡ç®—**ï¼š
- æœˆäº¤æ˜“é¢ï¼šÂ¥10,000
- æœˆæ‰‹ç»­è´¹ï¼šÂ¥10,000 Ã— 2% = Â¥200
- å¹´æ‰‹ç»­è´¹ï¼šÂ¥200 Ã— 12 = Â¥2,400

---

## ğŸš€ å®æ–½å»ºè®®

### é˜¶æ®µ1ï¼šå¼€å‘ç¯å¢ƒï¼ˆ1-2å¤©ï¼‰

1. æ³¨å†Œæ²™ç®±è´¦å·
2. é…ç½®å¼€å‘ç¯å¢ƒ
3. å®ç°åŸºæœ¬æ”¯ä»˜æµç¨‹
4. æœ¬åœ°æµ‹è¯•

### é˜¶æ®µ2ï¼šæµ‹è¯•ç¯å¢ƒï¼ˆ2-3å¤©ï¼‰

1. æ³¨å†Œæ­£å¼å•†æˆ·
2. é…ç½®ç”Ÿäº§ç¯å¢ƒ
3. éƒ¨ç½²Edge Functions
4. æ²™ç®±ç¯å¢ƒæµ‹è¯•

### é˜¶æ®µ3ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆ1å¤©ï¼‰

1. åˆ‡æ¢åˆ°ç”Ÿäº§å¯†é’¥
2. å°é¢çœŸå®æµ‹è¯•
3. ç›‘æ§æ—¥å¿—
4. æ­£å¼ä¸Šçº¿

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ªäººå¯ä»¥ç”³è¯·å¾®ä¿¡æ”¯ä»˜å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†æœ‰é™åˆ¶ï¼š
- éœ€è¦ç”³è¯·"å°å¾®å•†æˆ·"
- éœ€è¦æä¾›ç»è¥åœºæ‰€ç…§ç‰‡
- å•ç¬”é™é¢è¾ƒä½ï¼ˆ500å…ƒï¼‰
- æœˆäº¤æ˜“é¢é™åˆ¶ï¼ˆ10ä¸‡å…ƒï¼‰

**å»ºè®®**ï¼š
- å¦‚æœæ˜¯æ­£è§„è¿è¥ï¼Œå»ºè®®æ³¨å†Œå…¬å¸
- å¦‚æœæ˜¯ä¸ªäººé¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨èšåˆæ”¯ä»˜å¹³å°

---

### Q2: æ”¯ä»˜å›è°ƒä¸ç¨³å®šæ€ä¹ˆåŠï¼Ÿ

**A**: å¤šé‡ä¿éšœæœºåˆ¶ï¼š
1. ä¸»åŠ¨æŸ¥è¯¢ï¼šå‰ç«¯è½®è¯¢è®¢å•çŠ¶æ€
2. è¢«åŠ¨é€šçŸ¥ï¼šæ”¯ä»˜å¹³å°å›è°ƒ
3. å®šæ—¶ä»»åŠ¡ï¼šå®šæœŸæ£€æŸ¥æœªæ”¯ä»˜è®¢å•
4. æ‰‹åŠ¨å¤„ç†ï¼šåå°ç®¡ç†åŠŸèƒ½

---

### Q3: å¦‚ä½•å¤„ç†é€€æ¬¾ï¼Ÿ

**A**: å®ç°é€€æ¬¾åŠŸèƒ½ï¼š
```typescript
// å¾®ä¿¡æ”¯ä»˜é€€æ¬¾
const refund = await payment.refund({
  out_trade_no: order_no,
  out_refund_no: refund_no,
  total: total_amount,
  refund: refund_amount,
  reason: 'ç”¨æˆ·ç”³è¯·é€€æ¬¾',
});

// æ”¯ä»˜å®é€€æ¬¾
const refund = await alipaySdk.exec('alipay.trade.refund', {
  bizContent: {
    out_trade_no: order_no,
    refund_amount: refund_amount,
    refund_reason: 'ç”¨æˆ·ç”³è¯·é€€æ¬¾',
  },
});
```

---

### Q4: å¦‚ä½•é˜²æ­¢é‡å¤æ”¯ä»˜ï¼Ÿ

**A**: è®¢å•çŠ¶æ€æ§åˆ¶ï¼š
```typescript
// æ£€æŸ¥è®¢å•çŠ¶æ€
const { data: order } = await supabase
  .from('payment_orders')
  .select('status')
  .eq('order_no', order_no)
  .single();

if (order.status === 'paid') {
  throw new Error('è®¢å•å·²æ”¯ä»˜');
}

// ä½¿ç”¨æ•°æ®åº“é”
await supabase.rpc('lock_order', { p_order_no: order_no });
```

---

### Q5: æ”¯ä»˜å¤±è´¥å¦‚ä½•å¤„ç†ï¼Ÿ

**A**: å‹å¥½çš„é”™è¯¯å¤„ç†ï¼š
```typescript
try {
  const result = await createPaymentOrder(...);
} catch (error) {
  if (error.code === 'ORDERPAID') {
    toast.error('è®¢å•å·²æ”¯ä»˜ï¼Œè¯·å‹¿é‡å¤æ”¯ä»˜');
  } else if (error.code === 'ORDERCLOSED') {
    toast.error('è®¢å•å·²å…³é—­ï¼Œè¯·é‡æ–°ä¸‹å•');
  } else {
    toast.error('æ”¯ä»˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  }
}
```

---

## ğŸ“š ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£

- [å¾®ä¿¡æ”¯ä»˜å¼€å‘æ–‡æ¡£](https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml)
- [æ”¯ä»˜å®å¼€æ”¾å¹³å°](https://opendocs.alipay.com/)
- [Supabase Edge Functions](https://supabase.com/docs/guides/functions)

### SDKå’Œå·¥å…·

- [wechatpay-node-v3](https://github.com/klover2/wechatpay-node-v3-ts)
- [alipay-sdk](https://github.com/alipay/alipay-sdk-nodejs-all)
- [qrcode](https://github.com/soldair/node-qrcode)

### èšåˆæ”¯ä»˜å¹³å°

- [Ping++](https://www.pingxx.com/)
- [BeeCloud](https://beecloud.cn/)
- [PayJS](https://payjs.cn/)
- [è™çš®æ¤’](https://www.xunhupay.com/)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2026-01-19  
**é€‚ç”¨ç³»ç»Ÿ**ï¼šäºŒæ‰‹è½¦é”€å”®ç®¡ç†ç³»ç»Ÿ v2.0+
