# 车行审核功能使用指南

## 功能概述

车行审核功能允许平台超级管理员（super_admin）审核新车行的注册申请，确保平台上的车行都是经过验证的合法商户。

## 访问权限

- **仅限超级管理员**：只有角色为 `super_admin` 的用户可以访问车行管理页面
- **访问路径**：登录后台 → 侧边栏 → 车行管理

## 功能特性

### 1. 分类显示

车行按状态分为四个标签页：

- **待审核**：新提交的注册申请，显示红色徽章提示数量
- **正常运营**：已审核通过并正常运营的车行
- **已停用**：被管理员停用的车行
- **已拒绝**：审核未通过的车行申请

### 2. 审核操作

#### 审核通过
1. 在"待审核"标签页找到要审核的车行
2. 点击"查看"按钮查看详细信息（包括营业执照）
3. 确认信息无误后，点击"通过"按钮
4. 系统自动将车行状态改为 `active`，记录审核时间和审核人

#### 审核拒绝
1. 在"待审核"标签页找到要拒绝的车行
2. 点击"拒绝"按钮
3. 在弹出的对话框中填写拒绝原因（必填）
4. 点击"确认拒绝"
5. 系统将车行状态改为 `rejected`，保存拒绝原因

### 3. 车行详情

点击"查看"按钮可以查看车行的完整信息：

- **基本信息**：车行名称、车行代码、联系人、联系电话
- **地理位置**：省份、城市、区县、详细地址
- **营业执照**：上传的营业执照图片（可放大查看）
- **状态信息**：当前状态、申请时间、审核时间、拒绝原因（如有）

### 4. 车行管理

对于已审核通过的车行，管理员可以：

- **编辑信息**：修改车行的基本信息（车行代码不可修改）
- **停用/启用**：临时停用或重新启用车行
- **查看详情**：查看车行的完整信息

## 审核流程

```
用户提交注册申请
    ↓
车行状态：pending（待审核）
    ↓
管理员查看详情（营业执照、联系方式等）
    ↓
    ├─→ 审核通过 → 状态：active（正常运营）→ 车行可以登录使用
    └─→ 审核拒绝 → 状态：rejected（已拒绝）→ 记录拒绝原因
```

## 注意事项

1. **审核及时性**：建议及时处理待审核申请，避免用户等待过久
2. **拒绝原因**：拒绝申请时必须填写明确的拒绝原因，方便申请人了解问题
3. **营业执照核验**：审核时务必仔细核对营业执照信息的真实性
4. **车行代码唯一性**：车行代码一旦创建不可修改，审核时需确认代码合理性
5. **联系方式验证**：建议在审核通过前电话确认联系人信息

## 数据库字段说明

审核相关字段：

- `status`：车行状态（pending/active/inactive/rejected）
- `reviewed_at`：审核时间（审核通过或拒绝时自动记录）
- `reviewed_by`：审核人ID（记录是哪位管理员审核的）
- `rejected_reason`：拒绝原因（仅在拒绝时填写）

## 常见问题

### Q: 如何批量审核车行？
A: 目前需要逐个审核，确保每个车行都经过仔细核验。

### Q: 审核通过后可以撤销吗？
A: 可以通过"编辑"功能修改车行状态，或使用"停用"功能临时禁用车行。

### Q: 被拒绝的车行可以重新申请吗？
A: 可以，用户可以使用不同的车行代码重新提交申请。

### Q: 如何查看审核历史？
A: 在车行详情中可以看到审核时间和状态变更记录。

## 技术实现

- **前端页面**：`src/pages/Dealerships.tsx`
- **API接口**：`src/db/api.ts` - `dealershipsApi.update()`
- **数据库表**：`dealerships`
- **权限控制**：基于 `profile.role === 'super_admin'` 判断
