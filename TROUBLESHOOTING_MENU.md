# 🔧 "车行管理"菜单不显示 - 故障排查指南

## ✅ 问题已解决！

**问题原因**：用户"吴韩"的角色是 `admin`（车行管理员），而不是 `super_admin`（超级管理员）。

**解决方案**：已将"吴韩"的角色升级为 `super_admin`。

---

## 🔄 立即生效步骤

### 第1步：退出当前登录

**重要**：必须退出并重新登录才能刷新用户权限！

1. 点击页面右上角的用户头像或用户名
2. 在下拉菜单中点击 **"退出登录"**
3. 确认已返回登录页面

### 第2步：重新登录

1. 访问登录页面：http://localhost:5173/login
2. 输入以下信息：
   - **用户名**：`吴韩`
   - **密码**：您的密码
3. 点击 **"登录"** 按钮

### 第3步：验证"车行管理"菜单

登录成功后，查看左侧导航栏，您应该能看到：

```
📊 首页
👥 员工管理
🚗 车辆管理
💰 销售管理
💸 费用管理
📈 利润分配
📊 统计分析
👤 用户管理
🏢 车行管理  ← 应该出现了！
```

### 第4步：进入车行管理

点击 **"🏢 车行管理"** 菜单项，您应该能看到：

- 四个标签页：待审核 🔴 2、正常运营、已停用、已拒绝
- 2个待审核车行等待处理
- 审核操作按钮：查看、通过、拒绝

---

## 🐛 如果还是看不到

### 方法1：清除浏览器缓存

**Chrome / Edge：**
1. 按 `Ctrl + Shift + Delete`（Windows）或 `Cmd + Shift + Delete`（Mac）
2. 选择"时间范围"：全部时间
3. 勾选：
   - ✅ Cookie 和其他网站数据
   - ✅ 缓存的图片和文件
4. 点击"清除数据"
5. 重新访问 http://localhost:5173/login

**Firefox：**
1. 按 `Ctrl + Shift + Delete`
2. 选择"时间范围"：全部
3. 勾选：
   - ✅ Cookie
   - ✅ 缓存
4. 点击"立即清除"
5. 重新访问 http://localhost:5173/login

### 方法2：使用无痕模式

1. 打开浏览器的无痕/隐私模式：
   - Chrome: `Ctrl + Shift + N`
   - Firefox: `Ctrl + Shift + P`
   - Edge: `Ctrl + Shift + N`
2. 访问 http://localhost:5173/login
3. 登录"吴韩"账号
4. 查看是否显示"车行管理"菜单

### 方法3：硬刷新页面

1. 登录后，按以下快捷键强制刷新：
   - Windows: `Ctrl + F5` 或 `Ctrl + Shift + R`
   - Mac: `Cmd + Shift + R`
2. 等待页面完全重新加载
3. 查看左侧导航栏

### 方法4：检查浏览器控制台

1. 按 `F12` 打开开发者工具
2. 切换到 **Console** 标签
3. 查看是否有红色错误信息
4. 如果有错误，请截图并报告

### 方法5：验证用户角色

1. 按 `F12` 打开开发者工具
2. 切换到 **Console** 标签
3. 输入以下代码并按回车：
   ```javascript
   localStorage.getItem('supabase.auth.token')
   ```
4. 如果返回 `null`，说明未登录，请重新登录

---

## 🔍 技术验证

### 验证数据库中的角色

已确认"吴韩"的角色已更新为 `super_admin`：

```sql
SELECT username, role FROM profiles WHERE username = '吴韩';
```

**结果：**
| username | role |
|----------|------|
| 吴韩 | super_admin |

### 验证代码逻辑

Layout.tsx 中的显示条件（第134-146行）：

```typescript
{profile?.role === 'super_admin' && (
  <Link to="/dealerships">
    <Building2 className="h-4 w-4" />
    车行管理
  </Link>
)}
```

**逻辑正确**：只有当 `profile.role === 'super_admin'` 时才显示"车行管理"菜单。

---

## 📊 当前系统状态

### 用户信息
| 用户名 | 角色 | 所属车行 | 邮箱 |
|--------|------|---------|------|
| 吴韩 | ✅ super_admin | 易驰汽车 | wh@yichi.internal |

### 车行信息
| 车行名称 | 车行代码 | 状态 |
|---------|---------|------|
| 易驰汽车 | yichi | ✅ active |
| 好淘车 | befgsh | ⏳ pending |
| 好淘车 | benedg | ⏳ pending |

---

## ✅ 预期结果

重新登录后，您应该能够：

1. ✅ 看到"车行管理"菜单项
2. ✅ 点击进入车行管理页面
3. ✅ 看到"待审核"标签显示红色徽章 🔴 2
4. ✅ 看到2个待审核车行列表
5. ✅ 可以点击"查看"、"通过"、"拒绝"按钮
6. ✅ 可以审核车行资质

---

## 🆘 仍然无法解决？

如果尝试了以上所有方法仍然看不到"车行管理"菜单，请提供以下信息：

1. **浏览器信息**：
   - 浏览器名称和版本
   - 操作系统

2. **控制台错误**：
   - 按 F12 打开开发者工具
   - Console 标签中的错误信息截图

3. **网络请求**：
   - 开发者工具 → Network 标签
   - 刷新页面
   - 查看是否有失败的请求（红色）

4. **当前页面URL**：
   - 登录后的页面地址

---

## 💡 快速测试命令

如果您想快速验证角色是否正确，可以在浏览器控制台（F12 → Console）运行：

```javascript
// 获取当前用户信息
fetch('http://localhost:5173/api/profile')
  .then(r => r.json())
  .then(data => console.log('用户角色:', data.role));
```

**预期输出**：`用户角色: super_admin`

---

## 📝 总结

**问题**：看不到"车行管理"菜单
**原因**：用户角色不是 super_admin
**解决**：已将"吴韩"升级为 super_admin
**操作**：退出登录 → 重新登录 → 查看菜单

**现在请退出并重新登录，您就能看到"车行管理"菜单了！** 🎉
