# 在线支付功能快速使用指南

## 🎯 如何找到在线支付控件

### 步骤1：登录系统
1. 使用**车商管理员账号**登录系统
2. 确保您的账号角色是 `admin`（不是 `employee`）

### 步骤2：进入会员中心
1. 在左侧菜单栏找到 **"会员中心"** 菜单项（带皇冠图标 👑）
2. 点击进入会员中心页面

### 步骤3：找到在线续费卡片
1. 在会员中心页面向下滚动
2. 找到标题为 **"在线续费"** 的卡片
3. 副标题显示："选择会员等级，扫码支付后自动开通"

### 步骤4：查看会员等级
在线续费卡片中会显示四个会员等级：

| 会员等级 | 价格 | 车辆数量范围 |
|---------|------|------------|
| 三级会员 | ¥198/年 | 0-20台 |
| 二级会员 | ¥365/年 | 21-50台 |
| 一级会员 | ¥580/年 | 51-150台 |
| 金牌会员 | ¥980/年 | 151台以上 |

每个等级卡片都有一个 **"扫码支付"** 按钮。

---

## 💳 如何使用在线支付

### 完整支付流程

#### 1️⃣ 选择会员等级
- 点击任意会员等级卡片
- 例如：点击"三级会员"卡片

#### 2️⃣ 打开支付对话框
- 弹出"扫码支付"对话框
- 显示选中的会员等级和价格
- 显示提示："点击'生成支付码'后，请在30分钟内完成支付"

#### 3️⃣ 生成支付码
- 点击 **"生成支付码"** 按钮
- 等待1-2秒
- 显示订单号和二维码

#### 4️⃣ 扫码支付（测试模式）
由于这是演示系统，使用模拟支付功能：

1. 在支付对话框底部找到**黄色提示框**
2. 提示框标题："测试模式：点击下方按钮模拟支付成功"
3. 点击 **"模拟支付成功"** 按钮
4. 等待1-2秒

#### 5️⃣ 支付成功
- 显示提示："支付成功！会员已开通"
- 支付对话框自动关闭
- 会员中心页面自动刷新
- 会员信息更新

---

## 🔍 找不到在线支付控件？

### 检查清单

#### ✅ 检查1：确认账号角色
```
问题：我是员工账号，看不到会员中心菜单
解决：使用管理员账号登录（role = 'admin'）
```

#### ✅ 检查2：确认页面位置
```
问题：我在会员中心页面，但找不到在线续费卡片
解决：向下滚动页面，在线续费卡片位于页面中部
```

#### ✅ 检查3：确认页面加载
```
问题：页面一直显示"加载中..."
解决：
1. 刷新页面
2. 检查网络连接
3. 打开浏览器开发者工具（F12），查看Console错误
```

#### ✅ 检查4：确认数据库
```
问题：页面加载完成，但没有显示在线续费卡片
解决：检查数据库是否有会员等级数据

SQL查询：
SELECT * FROM membership_tiers ORDER BY tier_level DESC;

应该返回4条记录：
- 金牌会员（tier_level = 0）
- 一级会员（tier_level = 1）
- 二级会员（tier_level = 2）
- 三级会员（tier_level = 3）
```

---

## 📸 界面截图说明

### 会员中心页面布局

```
┌─────────────────────────────────────────┐
│  会员中心                                │
│  管理您的会员信息和续费                   │
├─────────────────────────────────────────┤
│                                         │
│  📊 当前会员状态                         │
│  ├─ 会员等级：三级会员                   │
│  ├─ 在售车辆数量：10台                   │
│  └─ 会员剩余：180天                      │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  📋 会员等级说明                         │
│  [四个会员等级卡片]                      │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  💳 在线续费  ← 这里！                   │
│  选择会员等级，扫码支付后自动开通         │
│                                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐      │
│  │三级 │ │二级 │ │一级 │ │金牌 │      │
│  │会员 │ │会员 │ │会员 │ │会员 │      │
│  │¥198│ │¥365│ │¥580│ │¥980│      │
│  │[扫码]│ │[扫码]│ │[扫码]│ │[扫码]│      │
│  └─────┘ └─────┘ └─────┘ └─────┘      │
│                                         │
│  ℹ️ 支付成功后，会员资格将自动开通        │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  📜 支付历史                             │
│  [支付记录列表]                          │
│                                         │
└─────────────────────────────────────────┘
```

---

## 🧪 测试步骤

### 快速测试流程

1. **登录系统**
   - 使用车商管理员账号登录

2. **进入会员中心**
   - 点击左侧菜单"会员中心"

3. **找到在线续费**
   - 向下滚动到"在线续费"卡片

4. **点击会员等级**
   - 点击"三级会员"卡片

5. **生成支付码**
   - 点击"生成支付码"按钮

6. **模拟支付**
   - 点击"模拟支付成功"按钮

7. **确认成功**
   - 查看提示："支付成功！会员已开通"
   - 页面自动刷新

---

## ❓ 常见问题

### Q1: 我是员工账号，为什么看不到会员中心？

**A:** 会员中心仅对管理员开放。员工账号无法访问会员中心功能。

**解决方法：**
- 使用管理员账号登录
- 或者联系管理员为您开通会员

---

### Q2: 我点击"生成支付码"后没有反应？

**A:** 可能是网络问题或Edge Function未部署。

**排查步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到"Console"标签
3. 查看是否有错误信息
4. 切换到"Network"标签
5. 查看是否有失败的请求

**常见错误：**
- `Edge Function not found`: Edge Function未部署
- `Network error`: 网络连接问题
- `Database error`: 数据库问题

---

### Q3: 二维码显示不出来？

**A:** 二维码使用外部服务生成，可能被防火墙拦截。

**解决方法：**
- 检查网络连接
- 检查防火墙设置
- 使用"模拟支付成功"按钮直接完成支付

---

### Q4: 点击"模拟支付成功"后没有反应？

**A:** 可能是数据库函数执行失败。

**排查步骤：**
1. 打开浏览器开发者工具（F12）
2. 查看Console错误信息
3. 检查订单号是否正确
4. 手动执行SQL验证：

```sql
-- 查询订单状态
SELECT * FROM payment_orders 
WHERE order_no = '订单号';

-- 手动执行支付成功
SELECT process_payment_success('订单号');
```

---

### Q5: 支付成功后会员信息没有更新？

**A:** 可能是页面缓存问题。

**解决方法：**
1. 手动刷新页面（F5）
2. 清除浏览器缓存
3. 重新登录系统

---

## 📞 需要帮助？

如果您仍然找不到在线支付控件或遇到其他问题，请：

1. **检查系统日志**
   - 打开浏览器开发者工具（F12）
   - 查看Console和Network标签
   - 截图错误信息

2. **检查数据库**
   - 确认membership_tiers表有数据
   - 确认payment_orders表已创建
   - 确认Edge Function已部署

3. **联系技术支持**
   - 提供错误截图
   - 提供账号信息（不要提供密码）
   - 描述操作步骤

---

## 📚 相关文档

- [在线支付功能说明](./ONLINE_PAYMENT_GUIDE.md)
- [在线支付测试指南](./ONLINE_PAYMENT_TEST_GUIDE.md)
- [会员制系统功能说明](./MEMBERSHIP_SYSTEM_GUIDE.md)

---

**文档版本**：v1.0  
**最后更新**：2026-01-10  
**适用系统**：二手车销售管理系统 v2.0+
